---
title: è®°å½•æ­¤åšå®¢çš„è¯ç”Ÿâ€”â€”ä¸‹
urlname: the-birth-of-the-blog-part-two
date: 2018-04-18 11:37:55
category: å·¥å…·
tags: tool
---

![](https://i.imgtg.com/2022/08/23/K6QbM.png)

<!-- more -->

æ¥ä¸Šæ–‡ï¼Œæœ¬ç¯‡ä¸»è¦æ˜¯æœåŠ¡å™¨çš„æ­å»ºğŸ§©

## æœåŠ¡å™¨æ­å»º

~~åœ¨é˜¿é‡Œäº‘è´­ä¹°äº†æœåŠ¡å™¨åï¼ŒæŠŠè‡ªå·±çš„åšå®¢æ”¾äº†ä¸Šå»~~ï¼ˆå·²è¿‡æœŸæœªç»­è´¹ï¼‰ã€‚ç³»ç»Ÿä¸ºUbuntu 16.4ï¼Œéœ€è¦å®‰è£…åŸºç¡€ç¯å¢ƒ

```bash
# é˜¿é‡Œäº‘å·²é…ç½®å¥½äº†æºï¼Œç›´æ¥æ›´æ–°å°±è¡Œ
sudo apt-get update
# å®‰è£…WebæœåŠ¡å™¨
sudo apt-get install nginx
sudo apt-get install apache2
```

æ ¹æ®æç¤ºç¬¦ï¼Œè¾“å…¥ Y ç¡®è®¤åï¼Œå¼€å§‹å®‰è£…è½¯ä»¶ï¼Œç›´è‡³è½¯ä»¶å®‰è£…å®Œæˆ

è½¯ä»¶å®‰è£…å®Œæˆåï¼Œé€šè¿‡é€šè¿‡ `dpkg -L` åˆ—å‡ºè½¯ä»¶åŒ…æ‰€åœ¨çš„ç›®å½•ï¼ŒåŠè¯¥è½¯ä»¶åŒ…ä¸­çš„æ‰€æœ‰æ–‡ä»¶

```bash
sudo /etc/init.d/apache2 start
# å®‰è£…Git
sudo apt-get install git
# ç”Ÿæˆ SSH key
ssh-keygen -t rsa -C "ä½ çš„ç”¨æˆ·å"
```

1. ç¬¬ä¸€æ¬¡æç¤ºä½ æƒ³å°† `key` ä¿å­˜åˆ°å“ªé‡Œï¼Œç›´æ¥å›è½¦ä»£è¡¨ä½¿ç”¨é»˜è®¤çš„ `/.ssh/id_rsa`
2. ç¬¬äºŒæ¬¡æç¤ºä½ è®¾ç½®ä¸€ä¸ªå£ä»¤å¯†ç ï¼Œç›´æ¥å›è½¦ä»£è¡¨è®¾ä¸ºç©º
3. ç¬¬ä¸‰æ¬¡é‡å¤ç¬¬äºŒæ¬¡çš„å¯†ç 

è¿›å…¥ `key` ä¿å­˜ä½ç½®ï¼Œæ‰“å¼€ *id_rsa.pub* ï¼Œå…¨éƒ¨å¤åˆ¶åå¤§å†™æ¨¡å¼ä¸¤ä¸‹ Z é€€å‡ºç¼–è¾‘

- è¿›å…¥ GitHubï¼Œæ‰“å¼€ `Settings`
- ç‚¹å‡» `SSH and GPG keys` é€‰é¡¹å¡
- ç‚¹å‡» `New SSH key` æŒ‰é’®ï¼Œå°†å¤åˆ¶çš„ `key` ç²˜è´´è¿›å»
- å–ä¸ªèƒ½è¯†åˆ«ç”¨é€”çš„åå­—ï¼Œä¿å­˜

å›åˆ°å‘½ä»¤è¡Œï¼Œæµ‹è¯• SSH key æ˜¯å¦é…ç½®æˆåŠŸï¼š

```bash
ssh -T git@github.com
# å‡ºç°å¦‚ä¸‹ä¿¡æ¯åˆ™è¯´æ˜æˆåŠŸä¸ GitHub è¿æ¥
Hi username! You've successfully authenticated, but GitHub does not provide shell access
```

```bash
# é…ç½® Git çš„ç”¨æˆ·åå’Œé‚®ç®±
git config --global user.name "ç”¨æˆ·å"
git config --global user.email "é‚®ç®±"
# æŸ¥çœ‹å·²æœ‰é…ç½®
git config user.name
git config user.email
```

## Apache é…ç½® SSL

ç°åœ¨æµè§ˆå™¨ä¸å†å»ºè®®ä½¿ç”¨ HTTPï¼Œä¼šæç¤ºç½‘ç«™ä¸å®‰å…¨ï¼Œéœ€è¦æŠŠç½‘ç«™æ›´æ¢ä¸º HTTPSï¼Œå¹¶å°† HTTP è®¿é—®çš„è‡ªåŠ¨è½¬å‘åˆ° HTTPS ç«¯å£ä¸Š

#### å¼€å¯SSLæ¨¡å—

```bash
sudo a2enmod ssl
```

è¿™æ¡å‘½ä»¤ç›¸å½“äºä¸‹é¢ 2 æ¡ï¼š

```bash
sudo ln -s /etc/apache2/mods-available/ssl.load /etc/apache2/mods-enabled
sudo ln -s /etc/apache2/mods-available/ssl.conf /etc/apache2/mods-enabled
```

å¦‚æœæ²¡æœ‰ `a2enmod` æŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨é…ç½®ä¸­è®¾ç½® SSL æ¨¡å—åŠ è½½ï¼š

```apacheconfig apache2.conf
LoadModule ssl_module /usr/lib/apache2/modules/mod_ssl.so
```

#### è¯ä¹¦

è¯ä¹¦æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œå¦å¤–ä¸€ç§æ˜¯ç¬¬ä¸‰æ–¹ CA æœºæ„ç­¾åè¯ä¹¦

ç¬¬ä¸€ç§éšä¾¿ä½¿ç”¨ï¼Œæ²¡æœ‰ç»è¿‡å®˜æ–¹è®¤å¯çš„æœºæ„è®¤è¯ã€‚åä¸€ç§åˆ™æ˜¯æ­£è§„çš„ç­¾åè¯ä¹¦ï¼Œæœ‰å‘è¯æœºæ„ç­¾å

é˜¿é‡Œäº‘æä¾›äº†å…è´¹çš„è‡ªç­¾åè¯ä¹¦ï¼Œä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»ºè‡ªç­¾åè¯ä¹¦

ä½¿ç”¨ apache å†…ç½®çš„å·¥å…·åˆ›å»ºé»˜è®¤çš„è‡ªç­¾åè¯ä¹¦ï¼Œé€šè¿‡ **-days** å‚æ•°æŒ‡å®šæœ‰æ•ˆæœŸï¼š

```bash
sudo apache2-ssl-certificate
```

åˆ›å»ºå®Œæˆåï¼Œå½“å‰ç›®å½•ä¸‹æœ‰ä¸ª *apache.pem* æ–‡ä»¶ï¼Œå·²ç»åŒ…å«å¯†é’¥å’Œè¯ä¹¦ã€‚å¯ä»¥æŠŠè¿™ä¸ªè¯ä¹¦æ‹·è´åˆ° */etc/apache2/* ä¸‹

#### ä¿®æ”¹é…ç½®

å®‰è£…å®Œåï¼Œä¼šåœ¨ */etc/apache2/sites-available/* ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª *default-ssl* æ–‡ä»¶

æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé“¾æ¥åˆ° *site-enabled* ç›®å½•

```bash
ln -s /etc/apache2/sites-available/default-ssl /etc/apache2/sites-enabled/001-ssl
```

ç¼–è¾‘ Apache ç«¯å£é…ç½®ï¼ŒåŠ å…¥ 443 ç«¯å£ï¼š

```conf /etc/apache2/ports.conf
Listen 80
Listen 443
```

æŠŠç«¯å£æ”¹ä¸º 443ï¼Œåœ¨ `<Virtualhost>` ä¸‹åŠ å…¥ SSL è®¤è¯é…ç½®ï¼Œå…¶å®ƒçš„æ ¹æ®éœ€è¦å®šåˆ¶ï¼š

```conf
<VirtualHost *:443>
    ServerAdmin liluoao@qq.com
    ServerName liluoao.com
    DocumentRoot /var/www/html
    SSLEngine on
    # æ·»åŠ  SSL åè®®
    SSLProtocol all -SSLv2 -SSLv3
    # ä¿®æ”¹åŠ å¯†å¥—ä»¶
    SSLCipherSuite HIGH:!RC4:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!EXP:+MEDIUM
    SSLHonorCipherOrder on
    # å…¬é’¥
    SSLCertificateFile /etc/apache2/cert/public.pem
    # ç§é’¥
    SSLCertificateKeyFile /etc/apache2/cert/1523613072453.key
    # é“¾é…ç½®
    SSLCertificateChainFile /etc/apache2/cert/chain.pem
</VirtualHost>
```

å¼€å¯é‡å®šå‘éœ€è¦åŠ è½½ `rewrite` æ¨¡å—

```bash
a2enmod rewrite
#æˆ–è€…ç”¨ä¸‹é¢è¿™å¥
ln -s /etc/apache2/mods-available/rewrite.load  /etc/apache2/mods-enabled/rewrite.load
```

ç¼–è¾‘ä½ çš„ HTTP é…ç½®ï¼š

```conf
<VirtualHost *:80>
    ServerName www.liluoao.com
    ServerAdmin liluoao@qq.com
    DocumentRoot /var/www/html
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    RewriteEngine on
    RewriteCond   %{HTTPS} !=on
    RewriteRule   ^(.*)  https://%{SERVER_NAME}$1 [L,R]
</VirtualHost>
```

æˆ–è€…æ˜¯åœ¨æ ¹ç›®å½•ç¼–è¾‘ *.htaccess* æ–‡ä»¶ï¼š

```htaccess .htaccess
RewriteEngine on
RewriteBase /
RewriteCond %{SERVER_PORT} !^443$
RewriteRule ^.* https://%{SERVER_NAME}%{REQUEST_URI} [L,R]
```
