---
title: å¾®ä¿¡å¡åˆ¸
urlname: wechat-card-and-coupon
date: 2018-04-13 11:16:17
category: å¾®ä¿¡å¼€å‘
tags: wechat
---

ğŸ’»[APIæ–‡æ¡£](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1451025056)

å¡åˆ¸ç±»å‹ï¼š
- CASHä»£é‡‘åˆ¸
- DISCOUNTæŠ˜æ‰£åˆ¸
- GIFTå…‘æ¢åˆ¸
- GENERAL_COUPONä¼˜æƒ åˆ¸
- MEMBER_CARDä¼šå‘˜å¡

#### ä¸Šä¼ å•†æˆ·Logo
éœ€è¦ `access_token`
è¯·æ±‚æ–¹å¼ï¼š`POST`
<!-- more -->
è¯·æ±‚åœ°å€ï¼š
```php
//å¾®ä¿¡API
config('wechat.api_uri') = 'https://api.weixin.qq.com';
/**
 * ä¸Šä¼ å›¾ç‰‡
 */
const API_UPLOAD_IMAGE = '/cgi-bin/media/uploadimg';
```
è¯·æ±‚å‚æ•°ï¼šæ–‡ä»¶æ•°æ®æµbuffer

#### åˆ›å»ºå¡åˆ¸
éœ€è¦ `access_token`
è¯·æ±‚æ–¹å¼ï¼š`POST`
è¯·æ±‚åœ°å€ï¼š
```php
/**
 * åˆ›å»ºå¡åˆ¸
 */
const API_ADD_CARD = '/card/create';
```
å‚æ•°ç¤ºä¾‹ï¼š
```json
{
    "card": {
        "card_type": "CASH",
        "cash": {
            "base_info": {
                "logo_url": "http://mmbiz.qpic.cn/mmbiz_jpg/EbflyuDyzFFff2rwM5euic6QScBjicOTLgQzExZJLDWaDIg5fDfkKjDI5CWZBIH75zLgFuSGkKIfetIOYz0mJaFQ/0",
                "brand_name": "è¯šä¿¡æ±½ä¿®",
                "code_type": "CODE_TYPE_NONE",
                "title": "æ ‡é¢˜",
                "sub_title": "å‰¯æ ‡é¢˜",
                "color": "Color010",
                "notice": "å¡åˆ¸æ“ä½œæç¤º",
                "service_phone": "",
                "description": "ä½¿ç”¨é¡»çŸ¥",
                "date_info": {
                    "type": "DATE_TYPE_FIX_TIME_RANGE",
                    "begin_timestamp": 1508137033,
                    "end_timestamp": 1571295442
                },
                "sku": {
                    "quantity": "100"
                },
                "use_limit": 100,
                "get_limit": "2",
                "use_custom_code": false,
                "bind_openid": false,
                "can_share": false,
                "can_give_friend": false,
                "center_title": "ç«‹å³ä½¿ç”¨"
            },
            "least_cost": "300",
            "reduce_cost": 5000
        }
    }
}
```
å­—æ®µå«ä¹‰ï¼š
```php
$data = [
    'card' => [
        'card_type' => 'MEMBER_CARD',
        'member_card' => [
            'background_pic_url'=> 'http://mmbiz.qpic.cn/mmbiz_jpg/EbflyuDyzFFff2rwM5euic6QScBjicOTLgQzExZJLDWaDIg5fDfkKjDI5CWZBIH75zLgFuSGkKIfetIOYz0mJaFQ/0',
            'base_info' => [
                "logo_url" => $ticketData['logo_url'], // å•†æˆ·logo
                "brand_name" => $merchantData['name'], // å•†æˆ·åå­—
                "code_type" => "CODE_TYPE_NONE",
                "title" =>  $ticketData['card_name'], // ä¼˜æƒ åˆ¸æ ‡é¢˜
                "sub_title" => $ticketData['sub_title'], // ä¼˜æƒ åˆ¸å‰¯æ ‡é¢˜
                "color" => $ticketData['color'], // å¡åˆ¸èƒŒæ™¯é¢œè‰²
                "notice" => $ticketData['notice'], // å¡åˆ¸æ“ä½œæç¤º
                "service_phone" => $merchantData['tel'], // å®¢æœç”µè¯
                "description" => $ticketData['description'] ? $ticketData['description'] : '', // ä½¿ç”¨é¡»çŸ¥
                'date_info' => [
                    "type" => "DATE_TYPE_FIX_TIME_RANGE",
                    "begin_timestamp" => strtotime($ticketData['begin_time']),
                    "end_timestamp" => strtotime($ticketData['end_time'])
                ],
                'sku' => [
                    "quantity" => $ticketData['card_num'] // å¡åˆ¸åº“å­˜
                ],
                "use_limit" => 1, // æ¯äººå¯æ ¸é”€çš„æ•°é‡é™åˆ¶
                "get_limit" => 1, // æ¯äººå¯é¢†åˆ¸çš„æ•°é‡é™åˆ¶
                "use_custom_code" => false, // æ˜¯å¦è‡ªå®šä¹‰codeç 
                "bind_openid" => false, // æ˜¯å¦æŒ‡å®šç”¨æˆ·é¢†å–
                "can_share" => false, // å¡åˆ¸é¢†å–é¡µé¢æ˜¯å¦å¯åˆ†äº«
                "can_give_friend" => false, // å¡åˆ¸æ˜¯å¦å¯è½¬èµ 
                "center_title" => "ç«‹å³ä½¿ç”¨", // å¡åˆ¸é¡¶éƒ¨å±…ä¸­çš„æŒ‰é’®
            ],
            "prerogative" => $ticketData['description'],// ä¼šå‘˜å¡ç‰¹æƒè¯´æ˜
            "auto_activate" => true,// è®¾ç½®ä¸ºtrueæ—¶ç”¨æˆ·é¢†å–ä¼šå‘˜å¡åç³»ç»Ÿè‡ªåŠ¨å°†å…¶æ¿€æ´»ï¼Œæ— éœ€è°ƒç”¨æ¿€æ´»æ¥å£
            "supply_bonus" => false,// æ˜¾ç¤ºç§¯åˆ†
            "supply_balance" => false,// æ˜¯å¦æ”¯æŒå‚¨å€¼
            "discount" => 10
        ]
    ]
];
```