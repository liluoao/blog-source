---
title: ä¾èµ–ç®¡ç†
urlname: dependency-management-with-packagist-and-satis
date: 2018-03-18 10:37:19
category: å·¥å…·
tags: composer
---

ä»‹ç»ä¸‹ç›¸å…³å·¥å…·ï¼Œå‘å¸ƒä¸€ä¸ªè‡ªå·±çš„åŒ…ï¼Œå’Œåœ¨å±€åŸŸç½‘ä¸­æ­å»ºä¸€ä¸ªåŒ…ç®¡ç†å¹³å°ğŸŒï¸â€â™€ï¸

<!-- more -->

## Composer

[Composer](https://docs.phpcomposer.com/00-intro.html) æ˜¯ PHP çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œå®ƒä¸ºä½ è§£å†³è¿™ç±»é—®é¢˜ï¼š

- ä½ æœ‰ä¸€ä¸ªé¡¹ç›®ä¾èµ–äºè‹¥å¹²ä¸ªåº“
- å…¶ä¸­ä¸€äº›åº“ä¾èµ–äºå…¶ä»–åº“
- ä½ å£°æ˜ä½ æ‰€ä¾èµ–çš„ä¸œè¥¿
- æ‰¾å‡ºå“ªä¸ªç‰ˆæœ¬çš„åŒ…éœ€è¦å®‰è£…ï¼Œå¹¶å®‰è£…å®ƒä»¬ï¼ˆå°†å®ƒä»¬ä¸‹è½½åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼‰

è¦æƒ³ä½¿ç”¨ Composerï¼Œå°±å¿…é¡»è¦ä¸€ä¸ª *composer.json* æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†é¡¹ç›®çš„ä¾èµ–å’Œå…¶å®ƒçš„ä¸€äº›å…ƒæ•°æ®

## æ–‡ä»¶è¯¦è§£

```json
{
    "name": "liluoao/api-doc",
    "description": "Generate API doc from PHPDoc.",
    "keywords": [
        "api-documentation",
        "phpdoc"
    ],
    "homepage": "https://github.com/liluoao/api-doc",
    "authors": [
        {
            "name": "Li Luoao",
            "email": "liluoao@qq.com",
            "homepage": "https://github.com/liluoao",
            "role": "Developer"
        }
    ],
    "time": "2018-02-11",
    "license": "MIT",
    "type": "library",
    //è¦æ±‚ åŒ…æ‹¬ç¯å¢ƒä¸ä¾èµ–åŒ…
    "require": {
        "php": ">=5.4.0",
        "ext-json": "*"
    }
}
```

å½“é¡¹ç›®æœ‰æµ‹è¯•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å±æ€§

```json
{
  "require-dev": {
    "fzaninotto/faker": "^1.4",
    "mockery/mockery": "^1.0",
    "nunomaduro/collision": "^2.0",
    "orchestra/testbench": "3.7.6",
    "phpunit/phpunit": "7.5.1",
    "phpbench/phpbench": "^0.17.0"
  },
  "autoload-dev": {
    "psr-4": {
      "Tests\\": "tests/"
    }
  },
  "scripts": {
    "test": "vendor/bin/phpunit",
    "test-coverage": "vendor/bin/phpunit --coverage-html coverage"
  }
}
```

åƒ Laravel çš„æ•°æ®å¡«å……å¹¶æ²¡æœ‰å†™å‘½åç©ºé—´ï¼Œæ˜¯ç›´æ¥åœ¨æ­¤å®šä¹‰çš„ï¼Œè¿˜æœ‰å¸®åŠ©å‡½æ•°çš„æ–‡ä»¶ç­‰

```json
{
  "autoload": {
    "classmap": [
      "database/seeds",
      "database/factories"
    ],
    "files": [
      "src/helper.php"
    ],
    "psr-4": {
      "Liluoao\\ApiDoc\\": "src"
    },
  }
}
```

å¯ä»¥è‡ªåŠ¨æ·»åŠ åŒ…é‡Œçš„æœåŠ¡æä¾›è€…

```json
{
  "extra": {
    "laravel": {
      "providers": [
        "Liluoao\\Providers\\ServiceProvider"
      ],
      "dont-discover": [
        "barryvdh/laravel-ide-helper"
      ]
    }
  }
}
```

## Packagist

[Packagist](https://packagist.org/) æ˜¯åŒ…å­˜å‚¨åº“ï¼Œä¹Ÿæ˜¯ Composer çš„ä¸»è¦èµ„æºåº“

åœ¨ Submit é¡µå¡«å†™ä½ çš„é¡¹ç›®åœ°å€ï¼Œå¹¶åœ¨ä½ çš„é¡¹ç›®è®¾ç½®ä¸­å¼€å¯ packagist æœåŠ¡ï¼Œè®©ä»£ç åŒæ­¥æ›´æ–°ï¼š

![GitHubé¡¹ç›®å¼€å¯æœåŠ¡](https://cdn.jsdelivr.net/gh/liluoao/cdn@main/image/composer-setting.png)

ä»¥ä¸Šé¢ä¾‹å­é¡¹ç›®å‘å¸ƒæˆåŠŸåç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º

![æˆåŠŸç¤ºä¾‹](https://cdn.jsdelivr.net/gh/liluoao/cdn@main/image/packagist-final.png)

## é•œåƒ

ç”±äºç½‘ç»œåŸå› ï¼Œä¸‹è½½åŒ…çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œå¯ä»¥æ›¿æ¢ä¸ºå›½å†…é•œåƒæé«˜é€Ÿåº¦ï¼š[Packagist é•œåƒä½¿ç”¨æ–¹æ³•](https://pkg.phpcomposer.com/#how-to-use-packagist-mirror)

> 2019-07 æ›´æ–°

[ã€ŠLaravel China é•œåƒå®Œæˆå†å²ä½¿å‘½ï¼Œå°†äºä¸¤ä¸ªæœˆååœç”¨ã€‹](https://learnku.com/articles/30758)
[ã€ŠComposer å›½å†…åŠ é€Ÿï¼šå¯ç”¨é•œåƒåˆ—è¡¨ ã€‹](https://learnku.com/php/wikis/30594)

## Satis ç®¡ç†ç§æœ‰èµ„æº

- ç”±äºå…¬å¸çš„æ¶æ„æ˜¯å†…å¤–ç½‘åˆ†ç¦»ï¼Œå¼€å‘åœ¨å†…éƒ¨å±€åŸŸç½‘ï¼Œæ— æ³•æ‹‰å–åˆ°å…¬ç½‘çš„ Packagist
- é¡ºä¾¿ç»´æŠ¤ä¸€äº›ç§æœ‰çš„åŒ…

å¥½åœ¨ Composer å®˜æ–¹æä¾›äº†è¿™æ ·çš„é™æ€ä»£ç åº“ç”Ÿæˆå™¨â€”â€”[Satis](https://docs.phpcomposer.com/articles/handling-private-packages-with-satis.html)

```
composer create-project composer/satis --stability=dev --keep-vcs
```

Satis çš„é…ç½®æ˜¯é€šè¿‡ satis.json è¿›è¡Œçš„

```json satis.json
{
  "name": "crm",
  "homepage": "http://10.0.20.252:10450",//æœ¬é¡¹ç›®åœ°å€ï¼Œå¯ä»¥WEBè®¿é—®
  "config": {
    "disable-tls": true,
    "secure-http": false
  },
  //é•œåƒç¼“å­˜è®¾ç½®ï¼Œè¯¥è®¾ç½®ä¼šç¼“å­˜requireé…ç½®é¡¹ä¸­å„ä¸ªä»“åº“çš„ä»£ç 
  "archive": {
    "directory": "dist"//ç›®å½•å
  },
  "require": {
    "monolog/monolog": "1.24.0"
    //...
  },
  "require-all": false,//ä¸ºtrueæ—¶å°†ä»ä»“åº“è·å–æ‰€æœ‰ç›¸å…³çš„ä¾èµ–åŒ…
  "repositories": [
    {
      "type": "git",
      "url": "http://10.0.20.254:10080/library/monolog/monolog.git"
    }
    //...
  ]
}
```

ç”Ÿæˆé¡¹ç›®

```
php bin/satis build satis.json public/
# æ·»åŠ æ–°çš„repo
php bin/satis add http://10.0.20.254:10080/library/guzzlehttp/guzzle.git satis.json
```

ä½¿ç”¨é™æ€åº“æ—¶ä¿®æ”¹ composer.json æ–‡ä»¶

```json composer.json
{
  "repositories": [
    {
      "packagist": false
    },
    {
      "type": "composer",
      "url": "http://10.0.20.252:10450"
    } 
  ],
  "config": {
      "disable-tls": true,
      "secure-http": false//éHTTPS
  }
}
```
